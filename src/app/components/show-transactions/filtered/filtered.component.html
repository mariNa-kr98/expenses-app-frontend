<h2 mat-dialog-title>Filter Transactions</h2>

<mat-dialog-content>
  <form [formGroup]="filterForm" (ngSubmit)="onFilterSubmit()">

    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Year</mat-label>
      <mat-select formControlName="year" required>
        <mat-option *ngFor="let y of years" [value]="y">{{ y }}</mat-option>
      </mat-select>
      <mat-error *ngIf="filterForm.get('year')?.invalid">Please select a year</mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Month</mat-label>
      <mat-select formControlName="month" required>
        <mat-option *ngFor="let m of months" [value]="m.value">{{ m.viewValue }}</mat-option>
      </mat-select>
      <mat-error *ngIf="filterForm.get('month')?.invalid">Please select a month</mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Category Type</mat-label>
      <mat-select formControlName="categoryType" (selectionChange)="onCategoryTypeChange()">
        <mat-option [value]="null">-- All Categories --</mat-option>
        <mat-option *ngFor="let ct of categoryTypes" [value]="ct">{{ ct }}</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Category</mat-label>
      <mat-select formControlName="categoryId">
        <mat-option [value]="null">-- All Categories --</mat-option> 
        <mat-option *ngFor="let subcat of filteredSubcategories" [value]="subcat.id">
          {{ subcat.label }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <label>
      <input type="checkbox" formControlName="includeDeleted" />Include deleted transactions
    </label>
    
    <div class="actions">
      <button class="btn btn-success mt-2 ms-2 mb-4" mat-button type="button" (click)="onCancel()" [disabled]="filterForm.invalid">Cancel</button>
      <button class="btn btn-success mt-2 ms-2 mb-4" type="submit" [disabled]="filterForm.invalid">Apply Filter</button>
    </div>
    
  </form>

  <div *ngIf="transactions.length > 0" class="transaction-results">
    <h3>Filtered Transactions</h3>
    <table class="transaction-table">
      <thead>
        <tr>
          <th>Amount</th>
          <th>Category</th>
          <th>Notes</th>
          <th>Created At</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let tx of transactions">
          <td>{{ tx.amount }}</td>
          <td>{{ tx.category.id }}</td> 
          <td>{{ tx.notes || 'â€”' }}</td>
          <td>{{ tx.createdAt | date: 'short' }}</td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <div *ngIf="transactions.length === 0">
    <p>No transactions found.</p>
  </div>
  
  
</mat-dialog-content>

